<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 親子天下 - 孩子個人大事記</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- html2canvas for image generation -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FFF7ED; /* Orange-50 */
        }
        /* Custom scrollbar for mobile experience */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Background pattern for the card */
        .card-pattern {
            background-image: radial-gradient(#FDBA74 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Animation for smooth transitions */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- 內建圖示元件 (移除外部依賴，確保穩定性) ---
        const IconBase = ({ children, ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" height="24" viewBox="0 0 24 24" 
                fill="none" stroke="currentColor" strokeWidth="2" 
                strokeLinecap="round" strokeLinejoin="round" 
                {...props}
            >
                {children}
            </svg>
        );

        const Star = (props) => (
            <IconBase {...props}>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
            </IconBase>
        );

        const Plus = (props) => (
            <IconBase {...props}>
                <path d="M5 12h14" />
                <path d="M12 5v14" />
            </IconBase>
        );

        const Trash2 = (props) => (
            <IconBase {...props}>
                <path d="M3 6h18" />
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                <line x1="10" x2="10" y1="11" y2="17" />
                <line x1="14" x2="14" y1="11" y2="17" />
            </IconBase>
        );

        const ChevronRight = (props) => (
            <IconBase {...props}>
                <path d="m9 18 6-6-6-6" />
            </IconBase>
        );

        const RefreshCw = (props) => (
            <IconBase {...props}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                <path d="M21 3v5h-5" />
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                <path d="M8 16H3v5" />
            </IconBase>
        );

        const Download = (props) => (
            <IconBase {...props}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" x2="12" y1="15" y2="3" />
            </IconBase>
        );

        // --- 主程式邏輯 ---

        // Default initial event
        const initialEvent = { id: 1, month: 1, content: '' };

        const App = () => {
            const [childName, setChildName] = useState('');
            const [events, setEvents] = useState([initialEvent]);
            const [showResult, setShowResult] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const cardRef = useRef(null);

            // Add a new empty event row
            const addEvent = () => {
                const newId = events.length > 0 ? Math.max(...events.map(e => e.id)) + 1 : 1;
                // Suggest next month automatically if possible
                const lastMonth = events.length > 0 ? parseInt(events[events.length - 1].month) : 0;
                const nextMonth = lastMonth < 12 ? lastMonth + 1 : 12;
                
                setEvents([...events, { id: newId, month: nextMonth, content: '' }]);
            };

            // Remove an event row
            const removeEvent = (id) => {
                if (events.length === 1) {
                    setEvents([{ ...events[0], content: '' }]); // Just clear if it's the last one
                    return;
                }
                setEvents(events.filter(e => e.id !== id));
            };

            // Update event data
            const updateEvent = (id, field, value) => {
                setEvents(events.map(e => e.id === id ? { ...e, [field]: value } : e));
            };

            // Validate and Generate
            const handleGenerate = () => {
                if (!childName.trim()) {
                    alert('請先輸入孩子的暱稱喔！');
                    return;
                }
                const validEvents = events.filter(e => e.content.trim() !== '');
                if (validEvents.length === 0) {
                    alert('請至少填寫一件大事記！');
                    return;
                }
                setShowResult(true);
                // Scroll to top
                window.scrollTo(0,0);
            };

            // Download Image Function
            const downloadImage = async () => {
                if (!cardRef.current) return;
                setIsGenerating(true);
                
                try {
                    // Wait a bit for images/fonts to stabilize
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    const canvas = await html2canvas(cardRef.current, {
                        scale: 2, // Higher resolution
                        useCORS: true,
                        backgroundColor: '#FFF7ED', // Match body bg
                    });

                    const image = canvas.toDataURL("image/png");
                    const link = document.createElement("a");
                    link.href = image;
                    link.download = `2025_${childName}_大事記.png`;
                    link.click();
                } catch (err) {
                    console.error("Image generation failed", err);
                    alert("圖片產生失敗，請試著手動截圖。");
                } finally {
                    setIsGenerating(false);
                }
            };

            // Sort events by month for the result view
            const sortedEvents = [...events]
                .filter(e => e.content.trim() !== '')
                .sort((a, b) => parseInt(a.month) - parseInt(b.month));

            return (
                <div className="min-h-screen pb-10">
                    {/* Header */}
                    <header className="bg-orange-500 text-white p-4 shadow-md sticky top-0 z-50">
                        <div className="max-w-md mx-auto flex items-center justify-between">
                            <h1 className="font-bold text-lg flex items-center gap-2">
                                <Star className="w-5 h-5 fill-yellow-300 stroke-yellow-300" />
                                親子天下 2025 年度專題
                            </h1>
                            <span className="text-xs bg-orange-600 px-2 py-1 rounded-full">互動模板</span>
                        </div>
                    </header>

                    <main className="max-w-md mx-auto p-4">
                        {!showResult ? (
                            /* --- EDITOR VIEW --- */
                            <div className="space-y-6 fade-in">
                                <div className="text-center space-y-2 mt-4">
                                    <h2 className="text-2xl font-bold text-gray-800">製作孩子的 2025 大事記</h2>
                                    <p className="text-gray-600 text-sm">記錄下今年的成長點滴，生成專屬回憶卡片</p>
                                </div>

                                {/* Child Name Input */}
                                <div className="bg-white p-4 rounded-2xl shadow-sm border border-orange-100">
                                    <label className="block text-gray-700 font-medium mb-2">孩子的暱稱 / 名字</label>
                                    <input 
                                        type="text" 
                                        placeholder="例如：小湯圓"
                                        className="w-full text-lg p-3 border border-orange-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-400 bg-orange-50"
                                        value={childName}
                                        onChange={(e) => setChildName(e.target.value)}
                                    />
                                </div>

                                {/* Events List */}
                                <div className="space-y-3">
                                    <div className="flex justify-between items-end px-1">
                                        <label className="text-gray-700 font-medium">發生了什麼大事？</label>
                                        <span className="text-xs text-orange-500">建議填寫 3-8 項</span>
                                    </div>
                                    
                                    {events.map((event, index) => (
                                        <div key={event.id} className="flex gap-2 items-start bg-white p-3 rounded-xl shadow-sm border border-gray-100 transition-all hover:border-orange-200">
                                            <div className="flex-shrink-0 w-20">
                                                <select 
                                                    className="w-full p-2 bg-gray-50 border border-gray-200 rounded-lg text-sm font-medium text-gray-700 focus:outline-none focus:border-orange-400"
                                                    value={event.month}
                                                    onChange={(e) => updateEvent(event.id, 'month', e.target.value)}
                                                >
                                                    {[...Array(12)].map((_, i) => (
                                                        <option key={i+1} value={i+1}>{i+1}月</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div className="flex-grow">
                                                <input 
                                                    type="text" 
                                                    placeholder="輸入事件 (例如: 學會騎腳踏車)"
                                                    className="w-full p-2 text-gray-800 placeholder-gray-400 focus:outline-none border-b border-transparent focus:border-orange-300 transition-colors"
                                                    value={event.content}
                                                    onChange={(e) => updateEvent(event.id, 'content', e.target.value)}
                                                />
                                            </div>
                                            <button 
                                                onClick={() => removeEvent(event.id)}
                                                className="p-2 text-gray-400 hover:text-red-500 transition-colors"
                                                aria-label="刪除"
                                            >
                                                <Trash2 />
                                            </button>
                                        </div>
                                    ))}

                                    <button 
                                        onClick={addEvent}
                                        className="w-full py-3 border-2 border-dashed border-orange-300 text-orange-500 rounded-xl font-medium hover:bg-orange-50 transition-colors flex items-center justify-center gap-2"
                                    >
                                        <Plus />
                                        新增一項大事
                                    </button>
                                </div>

                                {/* Generate Button */}
                                <div className="pt-4 pb-8">
                                    <button 
                                        onClick={handleGenerate}
                                        className="w-full py-4 bg-orange-500 text-white rounded-full font-bold text-lg shadow-lg hover:bg-orange-600 active:scale-95 transition-all flex items-center justify-center gap-2"
                                    >
                                        產生專屬大事記
                                        <ChevronRight />
                                    </button>
                                </div>
                            </div>
                        ) : (
                            /* --- RESULT VIEW --- */
                            <div className="space-y-6 fade-in">
                                <div className="flex justify-between items-center">
                                    <button 
                                        onClick={() => setShowResult(false)}
                                        className="text-gray-500 flex items-center gap-1 hover:text-orange-600"
                                    >
                                        <RefreshCw size={16} /> 重新編輯
                                    </button>
                                    <span className="text-sm text-gray-400">預覽模式</span>
                                </div>

                                {/* THE CARD TO BE CAPTURED */}
                                <div 
                                    ref={cardRef} 
                                    className="bg-white rounded-none md:rounded-3xl shadow-2xl overflow-hidden relative"
                                    style={{ minHeight: '500px' }}
                                >
                                    {/* Decorative Top */}
                                    <div className="bg-orange-500 h-4 w-full"></div>
                                    <div className="bg-yellow-400 h-2 w-full"></div>
                                    
                                    {/* Content Container */}
                                    <div className="p-8 card-pattern bg-orange-50/50 h-full relative">
                                        
                                        {/* Watermark/Logo */}
                                        <div className="absolute top-6 right-6 opacity-80">
                                             <div className="text-xs font-bold text-orange-600 border border-orange-600 px-2 py-1 rounded">親子天下 2025</div>
                                        </div>

                                        {/* Header */}
                                        <div className="mb-8 mt-2">
                                            <div className="inline-block bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-sm font-bold mb-3">
                                                2025 成 長 紀 錄
                                            </div>
                                            <h2 className="text-3xl font-black text-gray-800 leading-tight">
                                                <span className="text-orange-600">{childName}</span> 的<br/>
                                                2025 年度大事記
                                            </h2>
                                        </div>

                                        {/* Timeline */}
                                        <div className="space-y-0 relative">
                                            {/* Vertical Line */}
                                            <div className="absolute left-6 top-2 bottom-2 w-0.5 bg-orange-200"></div>

                                            {sortedEvents.map((event, idx) => (
                                                <div key={idx} className="relative flex items-start gap-4 mb-6 last:mb-0 group">
                                                    {/* Month Bubble */}
                                                    <div className="relative z-10 flex-shrink-0 w-12 h-12 bg-white border-4 border-orange-100 rounded-full flex items-center justify-center shadow-sm">
                                                        <span className="text-orange-600 font-black text-sm">{event.month}月</span>
                                                    </div>
                                                    
                                                    {/* Event Text */}
                                                    <div className="pt-2 pb-2 bg-white/80 p-3 rounded-lg shadow-sm border border-orange-100 w-full backdrop-blur-sm">
                                                        <p className="text-gray-800 font-medium text-lg leading-relaxed">
                                                            {event.content}
                                                        </p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* Footer */}
                                        <div className="mt-12 pt-6 border-t border-orange-200/50 flex justify-between items-end">
                                            <div>
                                                <p className="text-orange-800 font-bold text-sm">每一個時刻都值得被記住。</p>
                                                <p className="text-orange-400 text-xs mt-1">#2025親子天下年度專題</p>
                                            </div>
                                            
                                            {/* Decorative Elements */}
                                            <div className="flex gap-1">
                                                <Star className="w-5 h-5 text-yellow-400 fill-yellow-400" />
                                                <Star className="w-4 h-4 text-orange-300 fill-orange-300 mt-2" />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Decorative Bottom Bar */}
                                    <div className="bg-orange-500 h-3 w-full absolute bottom-0"></div>
                                </div>

                                {/* Action Buttons */}
                                <div className="space-y-3 pb-8">
                                    <button 
                                        onClick={downloadImage}
                                        disabled={isGenerating}
                                        className="w-full py-4 bg-gray-800 text-white rounded-full font-bold text-lg shadow-lg hover:bg-black active:scale-95 transition-all flex items-center justify-center gap-2"
                                    >
                                        {isGenerating ? '製作中...' : (
                                            <>
                                                <Download />
                                                下載圖片保存
                                            </>
                                        )}
                                    </button>
                                    <p className="text-center text-xs text-gray-500">
                                        若無法下載，請直接手機截圖即可保存分享
                                    </p>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
